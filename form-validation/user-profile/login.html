<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f1f1f1;
            height: 100vh;
            display: flex;
        }

        .sidebar {
            width: 220px;
            background-color: #2c2c2c;
            color: #fff;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            padding: 1rem;
        }

        .sidebar h3 {
            font-weight: 700;
            margin-bottom: 1rem;
        }

        .sidebar a {
            color: #fff;
            text-decoration: none;
            padding: 0.5rem 1rem;
            display: block;
            border-radius: 5px;
            margin-block: 5px;
        }

        .sidebar a:hover {
            color: rgb(98, 47, 16);
            background-color: #eae5e0;
            font-weight: 600;
        }

        /* Main content */
        .main-content {
            flex: 1;
            overflow-y: auto;
        }

        /* Top navbar */
        .topbar {
            background-color: #fff !important;
            border-bottom: 1px solid #2c2c2c55;
            padding: 10px 30px;
            display: flex;
            justify-content: flex-end;
            align-items: center;
            margin-bottom: 2rem;
        }

        .topbar .welcome {
            margin-right: 1rem;
            font-weight: 600;
        }

        .topbar .email {
            font-size: 12px;
            margin-right: 1rem;
        }

        .topbar .avatar {
            width: 40px;
            height: 40px;
            border-radius: 100%;
            object-fit: cover;
        }
    </style>
</head>

<body>
    <!-- Sidebar -->
    <div class="sidebar">
        <h3>My App</h3>
        <a href="./dashboard.html">Dashboard</a>
        <a href="./profile.html">Profile</a>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <div class="topbar !bg-white">
            <div class="d-flex flex-column justify-content-end align-items-end">
                <div class="welcome" id="welcomeMessage">Welcome, .....!</div>
                <div class="email" id="email">example@gmail.com</div>
            </div>
            <img class="avatar" id="avatar" src=""></img>
        </div>


        <!-- Profile Form -->
        <div class="container d-flex align-items-start justify-content-center min-vh-100">
            <div class="register-card">
                <form class="d-flex flex-column">
                    <div class="row mb-3">
                        <div class="col ">
                            <input type="text" id="firstName" class="form-control" placeholder="First name" />
                        </div>
                        <div class="col ps-0">
                            <input type="text" id="lastName" class="form-control" placeholder="Last name" />
                        </div>
                    </div>

                    <input type="email" id="inputEmail" class="form-control mb-3" placeholder="Email address" />

                    <button type="button" class="btn btn-primary" onclick="updateProfile()">Save</button>
                </form>
            </div>
        </div>
    </div>

    <script>
        const username = document.getElementById('welcomeMessage');
        const email = document.getElementById('email');
        const avatar = document.getElementById('avatar');


        // Profile
        const iFirstName = document.getElementById('firstName');
        const iLastName = document.getElementById('lastName');
        const iEmail = document.getElementById('inputEmail');


        fetch('http://blogs.csm.linkpc.net/api/v1/auth/profile', {

            headers: { 'Authorization': `Bearer ${localStorage.getItem('token')}` }
        })
            .then(res => res.json())
            .then(data => {
                const profile = data.data;

                // Navbar
                username.innerText = `Welcome, ${profile.firstName} ${profile.lastName}!`;
                email.innerText = profile.email;
                avatar.src = profile.avatar;


                // Profile
                iFirstName.value = profile.firstName;
                iLastName.value = profile.lastName;
                iEmail.value = profile.email;

            })
            .catch(err => console.error(err));


        const updateProfile = () => {
            const payload = {
                firstName: iFirstName.value,
                lastName: iLastName.value,
                email: iEmail.value,
                
            };

            // PUT
            fetch('http://blogs.csm.linkpc.net/api/v1/profile', {
                
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${localStorage.getItem('token')}`
                },
                body: JSON.stringify(payload)
            })
                .then(res => res.json())
                .then(data => {
                    const profile = data.data;
                    username.innerText = `Welcome, ${profile.firstName} ${profile.lastName}!`;
                    email.innerText = profile.email;
                    avatar.src = profile.avatar;
                })
                .catch(error => console.error(error));
        }
    </script>

</body>

</html>
