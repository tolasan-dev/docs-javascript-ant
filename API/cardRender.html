<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Products List</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      .product-img {
        max-width: 100px;
        height: auto;
        object-fit: contain;
      }
      .card-body {
        display: flex;
        flex-direction: column;
        justify-content: space表現-between;
      }
    </style>
  </head>
  <body>
    <div class="container mt-4">
      <h1 class="text-center mb-4">Products List</h1>

      <!-- Search Bar -->
      <div class="d-flex gap-2 mb-4">
        <input
          type="number"
          id="productIdInput"
          class="form-control"
          placeholder="Enter product ID (1-20)"
          min="1"
          max="20"
        />
        <button id="searchBtn" class="btn btn-dark">Search</button>
        <button id="resetBtn" class="btn btn-outline-secondary">Reset</button>
      </div>

      <!-- Loading & Error Messages -->
      <div id="loading" class="text-center my-5">Loading products...</div>
      <div id="error" class="alert alert-danger d-none"></div>

      <div class="row" id="itemProduct"></div>
    </div>

    <script>
      const apiUrl = "https://fakestoreapi.com/products?limit=5";
      const productContainer = document.getElementById("itemProduct");
      const searchInput = document.getElementById("productIdInput");
      const searchBtn = document.getElementById("searchBtn");
      const resetBtn = document.getElementById("resetBtn");
      const loadingEl = document.getElementById("loading");
      const errorEl = document.getElementById("error");

      let allProducts = [];

      // === PROMISE-BASED FETCH ===
      function fetchProducts() {
        loadingEl.classList.remove("d-none");
        errorEl.classList.add("d-none");
        productContainer.innerHTML = "";

        fetch(apiUrl)
          .then((res) => {
            if (!res.ok) {
              throw new Error("Failed to fetch products");
            }
            return res.json();
          })
          .then((data) => {
            allProducts = data;
            renderProducts(allProducts);
          })
          .catch((err) => {
            showError(err.message);
          })
          .finally(() => {
            loadingEl.classList.add("d-none");
          });
      }

      // === RENDER PRODUCTS ===
      function renderProducts(products) {
        productContainer.innerHTML = "";

        if (products.length === 0) {
          productContainer.innerHTML = `
            <div class="col-12 text-center text-muted">
              <p>No products found.</p>
            </div>
          `;
          return;
        }

        products.forEach((product) => {

          // this statement for create col layout each of card 
          const col = document.createElement("div");
          col.className = "col-md-6  mb-4";

          const card = document.createElement("div");
          card.className = "card h-100 shadow-sm";

          card.innerHTML = `
            <div class="row g-0 h-100">
              <div class="col-4 d-flex align-items-center justify-content-center p-3 bg-light">
                <img 
                  src="${product.image}" 
                  class="product-img img-fluid rounded" 
                  alt="${escapeHtml(product.title)}"
                  loading="lazy"
                >
              </div>
              <div class="col-8">
                <div class="card-body d-flex flex-column">
                  <h5 class="card-title mb-2">${escapeHtml(product.title)}</h5>
                  <p class="card-text text-muted small flex-grow-1">
                    ${escapeHtml(truncateText(product.description, 100))}
                  </p>
                  <p class="text-success fw-bold mt-2">$${product.price.toFixed(
                    2
                  )}</p>
                </div>
              </div>
            </div>
          `;

          col.appendChild(card);
          productContainer.appendChild(col);
        });
      }

    
      function escapeHtml(text) {
        const div = document.createElement("div");
        div.textContent = text;
        return div.innerHTML;
      }

      function truncateText(text, maxLength) {
        return text.length > maxLength
          ? text.slice(0, maxLength) + "..."
          : text;
      }

      function showError(message) {
        errorEl.textContent = message;
        errorEl.classList.remove("d-none");
      }

      // === SEARCH BY ID ===
      searchBtn.addEventListener("click", () => {
        const id = parseInt(searchInput.value.trim());
        if (!id || id < 1 || id > 20) {
          showError("Please enter a valid product ID (1–20)");
          return;
        }

        const found = allProducts.find((p) => p.id === id);
        renderProducts(found ? [found] : []);
      });

      // === RESET ===
      resetBtn.addEventListener("click", () => {
        searchInput.value = "";
        errorEl.classList.add("d-none");
        renderProducts(allProducts);
      });

      // === INITIAL LOAD ===
      fetchProducts();
    </script>
  </body>
</html>
